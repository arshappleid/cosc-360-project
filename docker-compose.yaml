services:
    web-server:
        build:
            dockerfile: php.Dockerfile
            context: .
        restart: always
        volumes:
            - "./src/:/var/www/html/"
        ports:
            - "8080:80"
        depends_on:
            mysql-server:
                condition: service_healthy
        networks:
            subnet1:
                ipv4_address: 192.168.92.3 # other containors inside the network will be able to reach the database at this ipv4_address

    mysql-server:
        build:
            dockerfile: Dockerfile
            context: ./database
        restart: always
        environment:
            MYSQL_ROOT_PASSWORD: secret
        volumes:
            - ./database:/docker-entrypoint-initdb.d
        ports:
            - "3306:3306"
        healthcheck:
            test:
                [
                    "CMD",
                    "mysqladmin",
                    "ping",
                    "-h",
                    "localhost",
                    "-uroot",
                    "-psecret",
                ]
            interval: 5s
            timeout: 5s
            retries: 20
        networks:
            subnet1:
                ipv4_address: 192.168.92.2 # other containors inside the network will be able to reach the database at this ipv4_address

    phpmyadmin:
        image: phpmyadmin/phpmyadmin:5.0.1
        restart: always
        environment:
            PMA_HOST: mysql-server
            PMA_USER: root
            PMA_PASSWORD: secret
        ports:
            - "5055:80" #if you got getting port conflicts with phpmyadmin on port 5000, you can change (ie 5050)
        depends_on:
            mysql-server:
                condition: service_healthy

volumes:
    mysql-data:

networks:
    subnet1:
        ipam:
            driver: default
            config:
                - subnet: "192.168.92.0/24" ## subnet has 24 open spots
